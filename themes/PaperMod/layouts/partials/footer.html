{{- if not (.Param "hideFooter") }}
<footer class="footer">
    {{- if not site.Params.footer.hideCopyright }}
        {{- if site.Copyright }}
        <span>{{ site.Copyright | markdownify }}</span>
        {{- else }}
        <span>&copy; {{ now.Year }} <a href="{{ "" | absLangURL }}">{{ site.Title }}</a></span>
        {{- end }}
        {{- print " · "}}
    {{- end }}

    {{- with site.Params.footer.text }}
        {{ . | markdownify }}
        {{- print " · "}}
    {{- end }}

    <span>
        In Memoriam - Zé Bitela (Poeta, seresteiro e cantor)
    </span>
</footer>
{{- end }}

{{- if (not site.Params.disableScrollToTop) }}
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
{{- end }}

{{- partial "extend_footer.html" . }}

<script>
(function() {
    'use strict';
    
    const menu = document.getElementById('menu');
    if (menu) {
        const savedPosition = localStorage.getItem('menu-scroll-position');
        if (savedPosition) {
            menu.scrollLeft = parseInt(savedPosition, 10);
        }
        
        let scrollTimeout;
        menu.addEventListener('scroll', function() {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                localStorage.setItem('menu-scroll-position', menu.scrollLeft);
            }, 100);
        }, { passive: true });
    }

    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    document.body.addEventListener('click', function(e) {
        const target = e.target.closest('a[href^="#"]');
        
        if (!target) return;
        
        e.preventDefault();
        
        const href = target.getAttribute('href');
        const id = href.substring(1);
        
        if (!id) return;
        
        const targetElement = document.getElementById(decodeURIComponent(id));
        
        if (!targetElement) return;
        
        if (!prefersReducedMotion) {
            targetElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        } else {
            targetElement.scrollIntoView({
                block: 'start'
            });
        }
        
        if (id === 'top') {
            history.replaceState(null, '', window.location.pathname + window.location.search);
        } else {
            history.pushState(null, null, '#' + id);
        }
    });

})();
</script>

{{- if (not site.Params.disableScrollToTop) }}
<script>
(function() {
    'use strict';
    
    const topLink = document.getElementById('top-link');
    if (!topLink) return;
    
    const SCROLL_THRESHOLD = 800;
    let ticking = false;
    
    function updateTopLinkVisibility() {
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        
        if (scrollTop > SCROLL_THRESHOLD) {
            topLink.style.visibility = 'visible';
            topLink.style.opacity = '1';
        } else {
            topLink.style.visibility = 'hidden';
            topLink.style.opacity = '0';
        }
        
        ticking = false;
    }
    
    window.addEventListener('scroll', function() {
        if (!ticking) {
            window.requestAnimationFrame(updateTopLinkVisibility);
            ticking = true;
        }
    }, { passive: true });
    
    updateTopLinkVisibility();
})();
</script>
{{- end }}

{{- if (not site.Params.disableThemeToggle) }}
<script>
(function() {
    'use strict';
    
    const themeToggle = document.getElementById('theme-toggle');
    if (!themeToggle) return;
    
    themeToggle.addEventListener('click', function() {
        const isDark = document.body.classList.contains('dark');
        
        if (isDark) {
            document.body.classList.remove('dark');
            localStorage.setItem('pref-theme', 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem('pref-theme', 'dark');
        }
    });
})();
</script>
{{- end }}

{{- if (and (eq .Kind "page") (ne .Layout "archives") (ne .Layout "search") (.Param "ShowCodeCopyButtons")) }}
<script>
(function() {
    'use strict';
    
    const COPY_TEXT = '{{- i18n "code_copy" | default "copy" }}';
    const COPIED_TEXT = '{{- i18n "code_copied" | default "copied!" }}';
    const COPY_FEEDBACK_DELAY = 2000;
    
    document.body.addEventListener('click', function(e) {
        if (!e.target.classList.contains('copy-code')) return;
        
        const button = e.target;
        const codeBlock = button.closest('.highlight, pre')?.querySelector('code');
        
        if (!codeBlock) return;
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(codeBlock.textContent)
                .then(() => {
                    button.textContent = COPIED_TEXT;
                    setTimeout(() => {
                        button.textContent = COPY_TEXT;
                    }, COPY_FEEDBACK_DELAY);
                })
                .catch(err => console.error('Erro ao copiar:', err));
        } else {
            const range = document.createRange();
            range.selectNodeContents(codeBlock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            try {
                document.execCommand('copy');
                button.textContent = COPIED_TEXT;
                setTimeout(() => {
                    button.textContent = COPY_TEXT;
                }, COPY_FEEDBACK_DELAY);
            } catch (e) {
                console.error('Erro ao copiar:', e);
            }
            
            selection.removeRange(range);
        }
    });
    
    const codeBlocks = document.querySelectorAll('pre > code');
    const fragment = document.createDocumentFragment();
    
    codeBlocks.forEach(function(codeBlock) {
        const container = codeBlock.parentNode.parentNode;
        
        const copyButton = document.createElement('button');
        copyButton.classList.add('copy-code');
        copyButton.textContent = COPY_TEXT;
        copyButton.setAttribute('aria-label', 'Copy code to clipboard');
        
        if (container.classList.contains('highlight')) {
            container.appendChild(copyButton);
        } else if (container.parentNode.firstChild === container) {
            // td containing LineNos
        } else if (codeBlock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName === 'TABLE') {
            codeBlock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copyButton);
        } else {
            codeBlock.parentNode.appendChild(copyButton);
        }
    });
})();
</script>
{{- end }}
